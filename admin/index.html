<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒŸãƒŸãƒ« | ç®¡ç†è€…ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Teal (based on #01a17f) -->
    <!-- Application Structure Plan: ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§èªè¨¼ã‚’è¡Œã„ã€æˆåŠŸå¾Œã«ãƒ¡ã‚¤ãƒ³ã®ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹æ§‹é€ ã§ã™ã€‚ãƒ¡ã‚¤ãƒ³ç”»é¢ã¯ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤SPAå½¢å¼ã§ã€ã€Œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã€Œé¡§å®¢ç®¡ç†ã€ã€Œæ–°è¦ä¼æ¥­ç™»éŒ²ã€ã€Œç®¡ç†è€…è¨­å®šã€ã®å„æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ã“ã®æ§‹é€ ã¯ã€æ©Ÿå¯†æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã—ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸç®¡ç†è€…ãŒç›®çš„ã®æ“ä½œã‚’åŠ¹ç‡çš„ã«è¡Œãˆã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚å„æ©Ÿèƒ½ã¯æ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ãŠã‚Šã€ç‰¹ã«é¡§å®¢ç®¡ç†ç”»é¢ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®æ¢ç´¢ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰ã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆCSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰ã¨ã„ã†å…·ä½“çš„ãªã‚¿ã‚¹ã‚¯ã«æœ€é©åŒ–ã•ã‚ŒãŸUIã‚’æä¾›ã—ã¾ã™ã€‚ -->
    <!-- Visualization & Content Choices: 
        - Report Info: ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ -> Goal: Secure -> Viz/Presentation: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -> Interaction: IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã€‚èªè¨¼ã«å¤±æ•—ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
        - Report Info: ç™»éŒ²ä¼šç¤¾æƒ…å ±ä¸€è¦§ -> Goal: Explore Data -> Viz/Presentation: æœˆåˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãã®å¤šæ©Ÿèƒ½ãƒ†ãƒ¼ãƒ–ãƒ« -> Interaction: æœˆã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã™ã‚‹ã¨è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ãŒå‹•çš„ã«æ›´æ–°ã•ã‚Œã‚‹ã€‚CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã§è¡¨ç¤ºä¸­ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã§ãã‚‹ã€‚ã€Œè©³ç´°ã€ãƒœã‚¿ãƒ³ã§å€‹åˆ¥ãƒšãƒ¼ã‚¸ã«é·ç§»ã€‚
        - Report Info: é¡§å®¢è©³ç´° -> Goal: Analyze -> Viz/Presentation: ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã€Chart.jsã«ã‚ˆã‚‹æ£’ã‚°ãƒ©ãƒ•ã€ãƒ­ã‚°ãƒªã‚¹ãƒˆ -> Interaction: ã‚°ãƒ©ãƒ•ãƒ›ãƒãƒ¼ã§è©³ç´°è¡¨ç¤ºã€‚å˜ä¸€é¡§å®¢ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¤šè§’çš„ã«åˆ†æã§ãã‚‹ã€‚
        - Report Info: æ–°è¦ä¼æ¥­ç™»éŒ² -> Goal: Configure/Manage -> Viz/Presentation: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ã‚©ãƒ¼ãƒ  -> Interaction: ä¼æ¥­æƒ…å ±ã‚’å…¥åŠ›ã—ç™»éŒ²ã™ã‚‹ã¨ã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã€æ‰¿èªå¾Œã«é¡§å®¢ä¸€è¦§ã«è¿½åŠ ã•ã‚Œã‚‹ã€‚
        - Report Info: å…¨ä½“ã®åˆ©ç”¨çŠ¶æ³ -> Goal: Analyze -> Viz/Presentation: Chart.jsã«ã‚ˆã‚‹æ™‚ç³»åˆ—ã®æ£’ã‚°ãƒ©ãƒ•ã¨ã€æœˆé–“/ç´¯è¨ˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ -> Interaction: ã‚°ãƒ©ãƒ•ã®ãƒ›ãƒãƒ¼ã§å„æœˆã®è©³ç´°ãªæ•°å€¤ã‚’ç¢ºèªã§ãã‚‹ã€‚ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã§è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ã‚’åˆ‡ã‚Šæ›¿ãˆã€‚
        - Report Info: ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¿½åŠ  -> Goal: Configure/Manage -> Viz/Presentation: æ¨©é™è¨­å®šä»˜ãã®ãƒ•ã‚©ãƒ¼ãƒ  -> Interaction: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€æ¨©é™ã‚’å…¥åŠ›ã—ã¦æ–°ã—ã„ç®¡ç†è€…ã‚’è¿½åŠ ã™ã‚‹ã€‚
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .main-theme-color { color: #01a17f; }
        .main-theme-bg { background-color: #01a17f; }
        .main-theme-bg-hover:hover { background-color: #018a6b; }
        .main-theme-focus-ring:focus { --tw-ring-color: #01a17f; }
        .sidebar-link.active {
            background-color: #ccfbf1; /* teal-100 */
            color: #0f766e; /* teal-700 */
            font-weight: 600;
        }
        .sidebar-link:hover {
            background-color: #f0fdfa; /* teal-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            max-height: 300px;
        }
        .modal {
            display: none;
            transition: opacity 0.3s ease;
        }
        .modal.active {
            display: flex;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Login View -->
    <div id="login-view" class="min-h-screen flex flex-col items-center justify-center bg-teal-50 px-4">
        <div class="w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold main-theme-color">ãƒŸãƒŸãƒ«</h1>
                <p class="text-slate-600 mt-2">ç®¡ç†è€…ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹</p>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200">
                <h2 class="text-2xl font-bold text-center text-slate-800 mb-6">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
                <div class="space-y-6">
                    <div>
                        <label for="email" class="block text-sm font-medium text-slate-700">ãƒ­ã‚°ã‚¤ãƒ³ID</label>
                        <div class="mt-1">
                            <input id="email" name="email" type="email" required class="w-full p-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 main-theme-focus-ring focus:border-transparent" placeholder="your@email.com">
                        </div>
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-slate-700">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                        <div class="mt-1">
                            <input id="password" name="password" type="password" required class="w-full p-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 main-theme-focus-ring focus:border-transparent" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                        </div>
                    </div>
                    <p id="login-error" class="text-red-500 text-sm text-center hidden">IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    <div>
                        <button onclick="handleLogin()" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white main-theme-bg main-theme-bg-hover focus:outline-none focus:ring-2 focus:ring-offset-2 main-theme-focus-ring">
                            ãƒ­ã‚°ã‚¤ãƒ³
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App View -->
    <div id="app-view" class="hidden">
        <div class="flex h-screen bg-slate-100">
            <aside class="w-64 bg-white border-r border-slate-200 flex-shrink-0 hidden md:flex flex-col">
                <div class="h-16 flex items-center justify-center border-b border-slate-200 px-4">
                    <h1 class="text-2xl font-bold main-theme-color">ãƒŸãƒŸãƒ«</h1>
                </div>
                <nav class="flex-1 p-4 space-y-2">
                    <a href="#" onclick="switchView('dashboard')" class="sidebar-link active flex items-center px-4 py-2 text-slate-700 rounded-lg">
                        <span class="mr-3 text-lg">ğŸ“Š</span> ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                    </a>
                    <a href="#" onclick="switchView('clients')" class="sidebar-link flex items-center px-4 py-2 text-slate-700 rounded-lg">
                        <span class="mr-3 text-lg">ğŸ¢</span> é¡§å®¢ç®¡ç†
                    </a>
                    <a href="#" onclick="switchView('new-client')" class="sidebar-link flex items-center px-4 py-2 text-slate-700 rounded-lg">
                        <span class="mr-3 text-lg">ğŸ†•</span> æ–°è¦ä¼æ¥­ç™»éŒ²
                    </a>
                    <a href="#" onclick="switchView('admins')" class="sidebar-link flex items-center px-4 py-2 text-slate-700 rounded-lg">
                        <span class="mr-3 text-lg">ğŸ”‘</span> ç®¡ç†è€…è¨­å®š
                    </a>
                </nav>
                <div class="p-4 border-t border-slate-200">
                    <button onclick="handleLogout()" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg transition-colors">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
            </aside>

            <main class="flex-1 overflow-y-auto">
                <div id="view-dashboard" class="main-view p-6 md:p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-slate-900">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                        <div class="flex items-center space-x-2 bg-slate-200 p-1 rounded-lg">
                            <button id="monthly-btn" onclick="toggleDashboardView('monthly')" class="px-3 py-1 text-sm font-semibold rounded-md bg-white text-teal-700 shadow">æœˆé–“</button>
                            <button id="cumulative-btn" onclick="toggleDashboardView('cumulative')" class="px-3 py-1 text-sm font-semibold rounded-md text-slate-600">ç´¯è¨ˆ</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <h3 class="font-semibold text-slate-500">ç·å¥‘ç´„ç¤¾æ•°</h3>
                            <p id="total-clients" class="text-4xl font-bold mt-2"></p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <h3 id="questions-title" class="font-semibold text-slate-500">ç·è³ªå•æ•° (ä»Šæœˆ)</h3>
                            <p id="total-questions" class="text-4xl font-bold mt-2"></p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <h3 id="apicalls-title" class="font-semibold text-slate-500">ç·APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ä»Šæœˆ)</h3>
                            <p id="total-api-calls" class="text-4xl font-bold mt-2"></p>
                        </div>
                    </div>
                    <div class="mt-8 bg-white p-6 rounded-xl shadow border">
                        <h3 class="text-xl font-bold mb-4">æœˆæ¬¡è³ªå•æ•° å…¨ç¤¾åˆè¨ˆ</h3>
                        <div class="chart-container">
                            <canvas id="mainTrendChart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="view-clients" class="main-view p-6 md:p-8 hidden">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">é¡§å®¢ç®¡ç†</h2>
                    <div class="bg-white p-6 rounded-xl shadow border">
                        <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                            <input id="client-search" onkeyup="renderClientTable()" type="text" placeholder="ä¼æ¥­åã¾ãŸã¯IDã§æ¤œç´¢..." class="p-2 border border-slate-300 rounded-lg w-full md:w-auto">
                            <div class="flex items-center gap-4">
                                <div>
                                    <label for="month-filter" class="text-sm font-medium">è¡¨ç¤ºæœˆ:</label>
                                    <select id="month-filter" onchange="renderClientTable()" class="ml-2 p-2 border border-slate-300 rounded-lg">
                                        <option value="2025-07">2025å¹´7æœˆ</option>
                                        <option value="2025-06">2025å¹´6æœˆ</option>
                                        <option value="2025-05">2025å¹´5æœˆ</option>
                                    </select>
                                </div>
                                <button onclick="downloadCSV()" class="main-theme-bg main-theme-bg-hover text-white font-bold py-2 px-4 rounded-lg text-sm">CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="border-b bg-slate-50">
                                        <th class="p-3">ä¼æ¥­ID</th>
                                        <th class="p-3">ä¼šç¤¾å</th>
                                        <th class="p-3">ç™»éŒ²æ—¥</th>
                                        <th class="p-3">è³ªå•æ•°</th>
                                        <th class="p-3">APIãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</th>
                                        <th class="p-3">è©³ç´°</th>
                                    </tr>
                                </thead>
                                <tbody id="client-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="view-client-detail" class="main-view p-6 md:p-8 hidden">
                    <button onclick="switchView('clients')" class="mb-6 text-teal-600 hover:underline">&larr; é¡§å®¢ç®¡ç†ã«æˆ»ã‚‹</button>
                    <h2 id="detail-client-name" class="text-3xl font-bold text-slate-900 mb-6"></h2>
                    <div class="space-y-8">
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <h3 class="text-xl font-bold mb-4">ç™»éŒ²æƒ…å ±</h3>
                            <div id="detail-client-info" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <h3 class="text-xl font-bold mb-4">åˆ©ç”¨çŠ¶æ³ã‚µãƒãƒªãƒ¼</h3>
                            <div id="detail-client-stats" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-white p-6 rounded-xl shadow border">
                                <h3 class="text-xl font-bold mb-4">ã‚ˆãã‚ã‚‹è³ªå•ãƒˆãƒƒãƒ—5</h3>
                                <div class="chart-container" style="height: 250px; max-height: 250px;">
                                    <canvas id="clientFaqChart"></canvas>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow border">
                                <h3 class="text-xl font-bold mb-4">æœ€è¿‘ã®ä¼šè©±ãƒ­ã‚°</h3>
                                <ul id="client-recent-logs" class="space-y-3 text-sm"></ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-new-client" class="main-view p-6 md:p-8 hidden">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">æ–°è¦ä¼æ¥­ç™»éŒ²</h2>
                    <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow border">
                        <div class="space-y-4">
                            <div>
                                <label for="new-client-name" class="block text-sm font-medium text-slate-700">ä¼æ¥­å</label>
                                <input id="new-client-name" type="text" class="mt-1 w-full p-2 border border-slate-300 rounded-lg">
                            </div>
                            <div>
                                <label for="new-client-contact" class="block text-sm font-medium text-slate-700">æ‹…å½“è€…å</label>
                                <input id="new-client-contact" type="text" class="mt-1 w-full p-2 border border-slate-300 rounded-lg">
                            </div>
                            <div>
                                <label for="new-client-email" class="block text-sm font-medium text-slate-700">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                <input id="new-client-email" type="email" class="mt-1 w-full p-2 border border-slate-300 rounded-lg">
                            </div>
                            <div class="text-right pt-4">
                                <button onclick="handleNewClientRegistration()" class="main-theme-bg main-theme-bg-hover text-white font-bold py-2 px-6 rounded-lg">ç™»éŒ²ã™ã‚‹</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="view-admins" class="main-view p-6 md:p-8 hidden">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">ç®¡ç†è€…è¨­å®š</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-xl shadow border">
                             <h3 class="text-xl font-bold mb-4">ç®¡ç†è€…ä¸€è¦§</h3>
                             <ul id="admin-list" class="space-y-3">
                             </ul>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <h3 class="text-xl font-bold mb-4">æ–°è¦ç®¡ç†è€…è¿½åŠ </h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="new-admin-email" class="block text-sm font-medium text-slate-700">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                    <input id="new-admin-email" type="email" class="mt-1 w-full p-2 border border-slate-300 rounded-lg" placeholder="new.admin@example.com">
                                </div>
                                <div>
                                    <label for="new-admin-password" class="block text-sm font-medium text-slate-700">åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                                    <input id="new-admin-password" type="text" class="mt-1 w-full p-2 border border-slate-300 rounded-lg">
                                </div>
                                <div>
                                    <label for="new-admin-role" class="block text-sm font-medium text-slate-700">æ¨©é™</label>
                                    <select id="new-admin-role" class="mt-1 w-full p-2 border border-slate-300 rounded-lg">
                                        <option>ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆæ‹…å½“</option>
                                        <option>ç®¡ç†è€…</option>
                                        <option>ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†è€…</option>
                                    </select>
                                </div>
                                <div class="text-right">
                                    <button onclick="handleAddAdmin()" class="main-theme-bg main-theme-bg-hover text-white font-bold py-2 px-6 rounded-lg">è¿½åŠ ã™ã‚‹</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Email Confirmation Modal -->
    <div id="email-confirm-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
            <div class="p-6">
                <h3 class="font-bold text-lg mb-4">é€ä¿¡å†…å®¹ã®ç¢ºèª</h3>
                <div class="bg-slate-50 p-4 rounded-lg border text-sm space-y-2">
                    <p><strong>å®›å…ˆ:</strong> <span id="confirm-email"></span></p>
                    <p><strong>ä»¶å:</strong> ãƒŸãƒŸãƒ«ã¸ã‚ˆã†ã“ãï¼æœ¬ç™»éŒ²ã®ã”æ¡ˆå†…</p>
                    <div class="border-t pt-2 mt-2">
                        <p id="confirm-company-name"></p>
                        <p id="confirm-contact-name" class="mb-2"></p>
                        <p>ã“ã®åº¦ã¯ãƒŸãƒŸãƒ«ã«ãŠç”³ã—è¾¼ã¿ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
                        <p>ä»¥ä¸‹ã®URLã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€æœ¬ç™»éŒ²ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚</p>
                        <p class="mt-2"><a href="#" id="confirm-reg-url" class="text-teal-600 break-all"></a></p>
                    </div>
                </div>
            </div>
            <div class="bg-slate-100 px-6 py-3 flex justify-end gap-3 rounded-b-2xl">
                <button onclick="closeEmailConfirmModal()" class="bg-white hover:bg-slate-50 border border-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg text-sm">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="sendRegistrationEmail()" class="main-theme-bg main-theme-bg-hover text-white font-bold py-2 px-4 rounded-lg text-sm">é€ä¿¡ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        const loginView = document.getElementById('login-view');
        const appView = document.getElementById('app-view');
        const loginError = document.getElementById('login-error');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const mainViews = document.querySelectorAll('.main-view');
        const sidebarLinks = document.querySelectorAll('.sidebar-link');
        let clientFaqChartInstance = null;
        
        let clientData = [
            { name: 'æ ªå¼ä¼šç¤¾A', regDate: '2025-07-01', contactName: 'ç”°ä¸­', contactEmail: 'tanaka@a-corp.com', stats: { '2025-07': { questions: 1204, apiCalls: 15830 }, '2025-06': { questions: 980, apiCalls: 12500 }, '2025-05': { questions: 750, apiCalls: 9800 } }, faq: [{q: 'ç¦åˆ©åšç”Ÿã«ã¤ã„ã¦', c: 120}, {q: 'çµ¦ä¸ã«ã¤ã„ã¦', c: 95}, {q: 'ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯', c: 80}, {q: 'æ®‹æ¥­æ™‚é–“', c: 65}, {q: 'ç¤¾é¢¨', c: 50}], logs: [{ts: '1æ™‚é–“å‰', q:'å‰¯æ¥­ã¯ã§ãã¾ã™ã‹ï¼Ÿ'}, {ts: '3æ™‚é–“å‰', q:'å®¶è³ƒè£œåŠ©ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ'}]},
            { name: 'Bã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', regDate: '2025-06-15', contactName: 'éˆ´æœ¨', contactEmail: 'suzuki@b-corp.com', stats: { '2025-07': { questions: 850, apiCalls: 11200 }, '2025-06': { questions: 450, apiCalls: 6800 }, '2025-05': { questions: 0, apiCalls: 0 } }, faq: [{q: 'æ¥­å‹™å†…å®¹', c: 90}, {q: 'ç ”ä¿®åˆ¶åº¦', c: 85}, {q: 'ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹', c: 70}, {q: 'ç¦åˆ©åšç”Ÿ', c: 55}, {q: 'è©•ä¾¡åˆ¶åº¦', c: 40}], logs: [{ts: '2æ™‚é–“å‰', q:'æœªçµŒé¨“ã§ã‚‚å¿œå‹Ÿå¯èƒ½ã§ã™ã‹ï¼Ÿ'}, {ts: '5æ™‚é–“å‰', q:'ç ”ä¿®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ'}]},
            { name: 'åˆåŒä¼šç¤¾C', regDate: '2025-05-20', contactName: 'ä½è—¤', contactEmail: 'sato@c-corp.com', stats: { '2025-07': { questions: 2300, apiCalls: 28900 }, '2025-06': { questions: 1800, apiCalls: 24000 }, '2025-05': { questions: 500, apiCalls: 7200 } }, faq: [{q: 'çµ¦ä¸ã«ã¤ã„ã¦', c: 250}, {q: 'ç¦åˆ©åšç”Ÿã«ã¤ã„ã¦', c: 210}, {q: 'é¸è€ƒãƒ—ãƒ­ã‚»ã‚¹', c: 180}, {q: 'æ®‹æ¥­æ™‚é–“', c: 150}, {q: 'æœ‰çµ¦ä¼‘æš‡', c: 120}], logs: [{ts: '30åˆ†å‰', q:'ãƒœãƒ¼ãƒŠã‚¹ã¯ã„ã¤ã§ã™ã‹ï¼Ÿ'}, {ts: '1æ™‚é–“å‰', q:'æ˜‡çµ¦ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ'}]},
            { name: 'Dã‚µãƒ¼ãƒ“ã‚¹', regDate: '2025-07-05', contactName: 'é«˜æ©‹', contactEmail: 'takahashi@d-corp.com', stats: { '2025-07': { questions: 150, apiCalls: 2400 }, '2025-06': { questions: 0, apiCalls: 0 }, '2025-05': { questions: 0, apiCalls: 0 } }, faq: [{q: 'ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹', c: 30}, {q: 'æ–™é‡‘ãƒ—ãƒ©ãƒ³', c: 25}, {q: 'å°å…¥äº‹ä¾‹', c: 20}, {q: 'ã‚µãƒãƒ¼ãƒˆä½“åˆ¶', c: 15}, {q: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£', c: 10}], logs: [{ts: '1æ—¥å‰', q:'ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ'}, {ts: '2æ—¥å‰', q:'å°å…¥ã¾ã§ã®æœŸé–“ã¯ï¼Ÿ'}]},
        ];

        const adminUsers = [
            { email: 'tsuji@setmefree-hd.jp', role: 'ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†è€…' },
            { email: 'sato@q-set.dev', role: 'ç®¡ç†è€…' },
            { email: 'tanaka@q-set.dev', role: 'ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆæ‹…å½“' },
        ];

        function generateClientIds() {
            clientData = clientData.map((client, index) => {
                client.id = `qset${(index + 1).toString().padStart(3, '0')}`;
                return client;
            });
        }

        function handleLogin() {
            const email = emailInput.value;
            const password = passwordInput.value;
            if (email === 'tsuji@setmefree-hd.jp' && password === 'smf-hd2025') {
                loginView.classList.add('hidden');
                appView.classList.remove('hidden');
                initApp();
            } else {
                loginError.classList.remove('hidden');
            }
        }

        function handleLogout() {
            emailInput.value = '';
            passwordInput.value = '';
            loginError.classList.add('hidden');
            appView.classList.add('hidden');
            loginView.classList.remove('hidden');
        }

        function switchView(viewId) {
            mainViews.forEach(view => view.id === `view-${viewId}` ? view.classList.remove('hidden') : view.classList.add('hidden'));
            sidebarLinks.forEach(link => link.getAttribute('onclick').includes(viewId) ? link.classList.add('active') : link.classList.remove('active'));
        }

        function renderClientTable() {
            const selectedMonth = document.getElementById('month-filter').value;
            const searchTerm = document.getElementById('client-search').value.toLowerCase();
            const tableBody = document.getElementById('client-table-body');
            tableBody.innerHTML = '';
            
            const filteredData = clientData.filter(client => 
                client.name.toLowerCase().includes(searchTerm) || client.id.toLowerCase().includes(searchTerm)
            );

            filteredData.forEach(client => {
                const stats = client.stats[selectedMonth] || { questions: 0, apiCalls: 0 };
                const row = `
                    <tr class="border-b hover:bg-slate-50">
                        <td class="p-3 font-mono text-sm">${client.id}</td>
                        <td class="p-3 font-medium">${client.name}</td>
                        <td class="p-3 text-sm text-slate-500">${client.regDate}</td>
                        <td class="p-3 text-sm">${stats.questions.toLocaleString()}</td>
                        <td class="p-3 text-sm">${stats.apiCalls.toLocaleString()}</td>
                        <td class="p-3"><button onclick="showClientDetail('${client.id}')" class="text-teal-600 hover:underline text-sm font-semibold">è©³ç´°</button></td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        
        function renderClientDetailChart(client) {
            if (clientFaqChartInstance) clientFaqChartInstance.destroy();
            const ctx = document.getElementById('clientFaqChart').getContext('2d');
            clientFaqChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: client.faq.map(item => item.q),
                    datasets: [{
                        label: 'è³ªå•æ•°',
                        data: client.faq.map(item => item.c),
                        backgroundColor: 'rgba(1, 161, 127, 0.5)',
                        borderColor: '#01a17f',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        function showClientDetail(clientId) {
            const client = clientData.find(c => c.id === clientId);
            if (!client) return;

            document.getElementById('detail-client-name').textContent = client.name;
            const infoContainer = document.getElementById('detail-client-info');
            infoContainer.innerHTML = `
                <div><p class="text-xs text-slate-500">ä¼æ¥­ID</p><p class="font-medium font-mono">${client.id}</p></div>
                <div><p class="text-xs text-slate-500">æ‹…å½“è€…å</p><p class="font-medium">${client.contactName}</p></div>
                <div><p class="text-xs text-slate-500">ç™»éŒ²æ—¥</p><p class="font-medium">${client.regDate}</p></div>
                <div><p class="text-xs text-slate-500">é€£çµ¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</p><p class="font-medium">${client.contactEmail}</p></div>
            `;
            
            const statsContainer = document.getElementById('detail-client-stats');
            statsContainer.innerHTML = '';
            Object.keys(client.stats).sort().reverse().forEach(month => {
                const monthStats = client.stats[month];
                const card = `
                    <div class="bg-slate-50 p-4 rounded-lg border">
                        <h4 class="font-bold">${month.replace('-', 'å¹´')}æœˆ</h4>
                        <p class="text-sm mt-2">è³ªå•æ•°: ${monthStats.questions.toLocaleString()}</p>
                        <p class="text-sm">APIãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°: ${monthStats.apiCalls.toLocaleString()}</p>
                    </div>
                `;
                statsContainer.innerHTML += card;
            });
            
            const logsContainer = document.getElementById('client-recent-logs');
            logsContainer.innerHTML = '';
            client.logs.forEach(log => {
                const logItem = `<li class="border-b pb-2"><p>${log.q}</p><span class="text-xs text-slate-400">${log.ts}</span></li>`;
                logsContainer.innerHTML += logItem;
            });

            renderClientDetailChart(client);
            switchView('client-detail');
        }

        function handleNewClientRegistration() {
            const name = document.getElementById('new-client-name').value;
            const contact = document.getElementById('new-client-contact').value;
            const email = document.getElementById('new-client-email').value;

            if (name && contact && email) {
                document.getElementById('confirm-email').textContent = email;
                document.getElementById('confirm-company-name').textContent = `${name}`;
                document.getElementById('confirm-contact-name').textContent = `${contact} æ§˜`;
                const registrationUrl = `https://mimiru.ai/register?token=${Math.random().toString(36).substr(2)}`;
                document.getElementById('confirm-reg-url').textContent = registrationUrl;
                document.getElementById('confirm-reg-url').href = '#';
                document.getElementById('email-confirm-modal').classList.add('active');
            } else {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        function closeEmailConfirmModal() {
            document.getElementById('email-confirm-modal').classList.remove('active');
        }

        function sendRegistrationEmail() {
            const name = document.getElementById('new-client-name').value;
            const contact = document.getElementById('new-client-contact').value;
            const email = document.getElementById('new-client-email').value;

            const newId = `qset${(clientData.length + 1).toString().padStart(3, '0')}`;
            const newClient = {
                id: newId, name, regDate: new Date().toISOString().split('T')[0], contactName: contact, contactEmail: email,
                stats: { '2025-07': { questions: 0, apiCalls: 0 }, '2025-06': { questions: 0, apiCalls: 0 }, '2025-05': { questions: 0, apiCalls: 0 } },
                faq: [], logs: []
            };
            clientData.push(newClient);
            
            closeEmailConfirmModal();
            alert(`ç™»éŒ²æ¡ˆå†…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰`);
            
            document.getElementById('new-client-name').value = '';
            document.getElementById('new-client-contact').value = '';
            document.getElementById('new-client-email').value = '';

            renderClientTable();
            switchView('clients');
        }

        function downloadCSV() {
            const selectedMonth = document.getElementById('month-filter').value;
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "ä¼æ¥­ID,ä¼šç¤¾å,ç™»éŒ²æ—¥,è³ªå•æ•°,APIãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°\n";

            clientData.forEach(client => {
                const stats = client.stats[selectedMonth] || { questions: 0, apiCalls: 0 };
                const row = [client.id, client.name, client.regDate, stats.questions, stats.apiCalls].join(",");
                csvContent += row + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `mimiru_report_${selectedMonth}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function renderAdminList() {
            const adminList = document.getElementById('admin-list');
            adminList.innerHTML = '';
            adminUsers.forEach(user => {
                const roleColor = user.role === 'ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†è€…' ? 'bg-red-100 text-red-700' : user.role === 'ç®¡ç†è€…' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
                const item = `
                    <li class="flex items-center justify-between bg-slate-50 p-3 rounded-md">
                        <div>
                            <p class="font-medium">${user.email}</p>
                        </div>
                        <span class="${roleColor} text-xs font-semibold px-2.5 py-0.5 rounded-full">${user.role}</span>
                    </li>
                `;
                adminList.innerHTML += item;
            });
        }

        function handleAddAdmin() {
            const email = document.getElementById('new-admin-email').value;
            const password = document.getElementById('new-admin-password').value;
            const role = document.getElementById('new-admin-role').value;

            if (email && password && role) {
                adminUsers.push({ email, role });
                renderAdminList();
                alert(`ç®¡ç†è€…ã€Œ${email}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã¨åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰`);
                document.getElementById('new-admin-email').value = '';
                document.getElementById('new-admin-password').value = '';
            } else {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }
        
        function toggleDashboardView(viewType) {
            const monthlyBtn = document.getElementById('monthly-btn');
            const cumulativeBtn = document.getElementById('cumulative-btn');
            const questionsTitle = document.getElementById('questions-title');
            const apiCallsTitle = document.getElementById('apicalls-title');
            
            let totalQuestions, totalApiCalls;

            if (viewType === 'monthly') {
                monthlyBtn.classList.add('bg-white', 'text-teal-700', 'shadow');
                cumulativeBtn.classList.remove('bg-white', 'text-teal-700', 'shadow');
                cumulativeBtn.classList.add('text-slate-600');
                
                const currentMonth = document.getElementById('month-filter').value;
                questionsTitle.textContent = 'ç·è³ªå•æ•° (ä»Šæœˆ)';
                apiCallsTitle.textContent = 'ç·APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ä»Šæœˆ)';
                totalQuestions = clientData.reduce((sum, client) => sum + (client.stats[currentMonth]?.questions || 0), 0);
                totalApiCalls = clientData.reduce((sum, client) => sum + (client.stats[currentMonth]?.apiCalls || 0), 0);
            } else {
                cumulativeBtn.classList.add('bg-white', 'text-teal-700', 'shadow');
                monthlyBtn.classList.remove('bg-white', 'text-teal-700', 'shadow');
                monthlyBtn.classList.add('text-slate-600');
                
                questionsTitle.textContent = 'ç´¯è¨ˆè³ªå•æ•°';
                apiCallsTitle.textContent = 'ç´¯è¨ˆAPIãƒªã‚¯ã‚¨ã‚¹ãƒˆ';
                totalQuestions = clientData.reduce((sum, client) => sum + Object.values(client.stats).reduce((s, m) => s + m.questions, 0), 0);
                totalApiCalls = clientData.reduce((sum, client) => sum + Object.values(client.stats).reduce((s, m) => s + m.apiCalls, 0), 0);
            }
            document.getElementById('total-questions').textContent = totalQuestions.toLocaleString();
            document.getElementById('total-api-calls').textContent = totalApiCalls.toLocaleString();
        }

        function initApp() {
            generateClientIds();
            switchView('dashboard');
            renderClientTable();
            renderAdminList();

            document.getElementById('total-clients').textContent = clientData.length;
            toggleDashboardView('monthly');

            const chartCtx = document.getElementById('mainTrendChart').getContext('2d');
            const labels = ['2025-05', '2025-06', '2025-07'];
            const chartData = labels.map(label => 
                clientData.reduce((sum, client) => sum + (client.stats[label]?.questions || 0), 0)
            );
            new Chart(chartCtx, {
                type: 'bar',
                data: {
                    labels: labels.map(l => `${l.split('-')[1]}æœˆ`),
                    datasets: [{
                        label: 'ç·è³ªå•æ•°',
                        data: chartData,
                        backgroundColor: 'rgba(1, 161, 127, 0.5)',
                        borderColor: '#01a17f',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }
    </script>
</body>
</html>
